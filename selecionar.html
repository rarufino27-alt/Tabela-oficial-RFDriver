<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>RF – Selecionar viagem</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="core/datamanager.js"></script>
<script src="core/dinamico.js"></script>
<script src="core/taxas.js"></script>

<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
}

body{
  background:linear-gradient(to bottom, #0f0f0f, #1a1a1a);
  color:#ffffff;
  min-height:100vh;
}

/* ================= HEADER ================= */

.top-white{
  background:#ffffff;
  padding:20px 20px 28px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom-left-radius:32px;
  border-bottom-right-radius:32px;
  box-shadow:0 10px 30px rgba(0,0,0,.25);
}

.logo-area{
  display:flex;
  align-items:center;
  gap:14px;
}

.logo-img{
  height:60px;
  width:auto;
  border-radius:16px;
}

.logo-text-dark{
  font-weight:900;
  letter-spacing:1px;
  color:#000;
  font-size:1.1rem;
}

/* ================= CONTAINER ================= */

.container{
  width:90%;
  max-width:420px;
  margin:40px auto;
}

/* ================= CARD ================= */

.card{
  background:#1c1c1c;
  border-radius:20px;
  padding:20px;
  box-shadow:0 15px 35px rgba(0,0,0,.5);
  border:1px solid rgba(255,255,255,.05);
  margin-bottom:15px;
}

.categoria{
  cursor:pointer;
  transition:.2s;
}

.categoria.ativa{
  border-color:#facc15;
  box-shadow:0 0 20px rgba(250,204,21,.3);
}

.cat-desc{
  font-size:.8rem;
  color:#999;
}

.preco-dinamico{
  font-weight:700;
  color:#facc15;
}

.pag-item{
  padding:12px;
  border-radius:10px;
  margin-bottom:6px;
  cursor:pointer;
  border:1px solid rgba(255,255,255,.1);
}

.pag-item.ativo{
  background:#facc15;
  color:#000;
  font-weight:700;
}

.valor-total{
  font-size:1.4rem;
  font-weight:700;
  color:#facc15;
  margin:20px 0;
}

/* ================= BOTÃO ================= */

button{
  width:100%;
  padding:18px;
  border:none;
  border-radius:35px;
  background:#facc15;
  color:#000;
  font-weight:800;
  font-size:1rem;
  cursor:pointer;
}
</style>
</head>
<body>

<!-- HEADER -->
<div class="top-white">
  <div class="logo-area">
    <img src="icons/icon-192.png" class="logo-img">
    <span class="logo-text-dark">GRUPO RF</span>
  </div>
</div>

<div class="container">

  <h2 style="margin-bottom:20px;">Categoria de viagem</h2>

  <div class="card" id="rotaBox"></div>

  <div id="categorias"></div>

  <div class="card">
    <div style="font-weight:700; margin-bottom:10px;">Forma de pagamento</div>
    <div id="pagamentos"></div>
  </div>

  <div class="valor-total" id="valorTotal">R$ 0,00</div>

  <button onclick="solicitar()">Solicitar</button>

</div>

<script>

/* ===== SUA LÓGICA ORIGINAL ===== */

const corrida = JSON.parse(localStorage.getItem("rf_corrida_temp"));
if(!corrida) window.location.href = "viagem.html";

const { origem, parada, destino, valor } = corrida;

let rotaHTML = `<div><strong>Origem:</strong> ${origem}</div>`;
if(parada){
  rotaHTML += `<div><strong>Parada:</strong> ${parada}</div>`;
}
rotaHTML += `<div><strong>Destino:</strong> ${destino}</div>`;
document.getElementById("rotaBox").innerHTML = rotaHTML;

function aplicarNoturno(valorBase){
  const agora = new Date();
  const hora = agora.getHours();
  const minuto = agora.getMinutes();
  const horario = hora + (minuto/60);
  if(horario >= 22.5 || horario <= 5){
    return valorBase + Taxas.noturno.valorFixo;
  }
  return valorBase;
}

const categoriasData = [
  { nome:"Driver 4 Lugares", desc:"Até 4 Pessoas", mult:1.0 },
  { nome:"Driver 6 Lugares", desc:"Ideal para até 6 Pessoas", mult:1.5 }
];

let categoriaSelecionada = 0;
let pagamentoSelecionado = "Dinheiro";

function renderCategorias(){
  const box = document.getElementById("categorias");
  box.innerHTML = "";

  categoriasData.forEach((cat,index)=>{
    const card = document.createElement("div");
    card.className = "card categoria";
    if(index===0) card.classList.add("ativa");

    const base = valor * cat.mult;
    const noturno = aplicarNoturno(base);
    const valorFinal = Dinamico.ativo ? noturno * Dinamico.multiplicador : noturno;

    card.innerHTML = `
      <div style="display:flex; justify-content:space-between;">
        <div>
          <div>${cat.nome}</div>
          <div class="cat-desc">${cat.desc}</div>
        </div>
        <div class="preco-dinamico">
          R$ ${valorFinal.toFixed(2)}
        </div>
      </div>
    `;

    card.onclick = ()=>{
      document.querySelectorAll(".categoria").forEach(c=>c.classList.remove("ativa"));
      card.classList.add("ativa");
      categoriaSelecionada = index;
      atualizarTotal();
    };

    box.appendChild(card);
  });

  atualizarTotal();
}

function renderPagamentos(){
  const pagamentos = ["Dinheiro","Pix","Cartão"];
  const box = document.getElementById("pagamentos");
  box.innerHTML = "";

  pagamentos.forEach(p=>{
    const div = document.createElement("div");
    div.className = "pag-item";
    if(p==="Dinheiro") div.classList.add("ativo");
    div.innerText = p;

    div.onclick = ()=>{
      document.querySelectorAll(".pag-item").forEach(i=>i.classList.remove("ativo"));
      div.classList.add("ativo");
      pagamentoSelecionado = p;
      atualizarTotal();
    };

    box.appendChild(div);
  });
}

function atualizarTotal(){
  const cat = categoriasData[categoriaSelecionada];
  let base = valor * cat.mult;
  base = aplicarNoturno(base);
  let total = Dinamico.ativo ? base * Dinamico.multiplicador : base;

  document.getElementById("valorTotal").innerText =
    "R$ " + total.toFixed(2);

  localStorage.setItem("rf_categoria", cat.nome);
  localStorage.setItem("rf_pagamento", pagamentoSelecionado);
  localStorage.setItem("rf_valor_final", total);
}

function solicitar(){
  window.location.href = "resumo.html";
}

renderCategorias();
renderPagamentos();

</script>

</body>
</html>
